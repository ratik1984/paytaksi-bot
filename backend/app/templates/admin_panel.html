<!doctype html>
<html lang="az">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PayTaksi Admin Panel</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; background:#0b0f19; color:#fff}
    .wrap{max-width:1100px;margin:20px auto;padding:20px}
    .card{background:#121a2a;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;margin:12px 0}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;vertical-align:top}
    a{color:#8ab4ff}
    .muted{color:rgba(255,255,255,.7);font-size:14px}
    input,select,button{padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0b1222;color:#fff}
    button{background:#2b6cff;border:none;font-weight:700;cursor:pointer}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Admin Panel</h2>
    <div class="muted">MVP: sürücü təsdiqi, balans düzəlişi, sifarişlər.</div>

    <div class="row">
      <div class="card">
        <h3>Linklər</h3>
        <div><a href="/webapp/?from=passenger" target="_blank">Passenger WebApp</a></div>
        <div><a href="/webapp/?from=driver" target="_blank">Driver WebApp</a></div>
        <div><a href="/admin/logout">Çıxış</a></div>
      </div>
      <div class="card">
        <h3>Qaydalar</h3>
        <div class="muted">Komissiya: 10% | Start: 3.50 | 3km sonrası: 0.40/km | Driver blok: -10</div>
        <div class="muted">Sürücü: min 2010 | rəng: ağ/qara/qırmızı/boz/mavi/sarı/yaşıl</div>
      </div>
    </div>

    <div class="card">
      <h3>Sürücülər</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Ad</th><th>Avto</th><th>Status</th><th>Balans</th><th>Actions</th></tr>
        </thead>
        <tbody>
        {% for d in drivers %}
          <tr>
            <td>{{d["id"]}}</td>
            <td>{{d["name"]}}</td>
            <td>{{d["year"]}} / {{d["color"]}}</td>
            <td>
              {% if d["approved"] %}<span class="badge">APPROVED</span>{% else %}<span class="badge">PENDING</span>{% endif %}
              {% if d["online"] %}<span class="badge">ONLINE</span>{% endif %}
            </td>
            <td>{{d["balance"]}}</td>
            <td>
              <form method="post" action="/admin/driver/approve" style="display:inline-block;margin-right:8px">
                <input type="hidden" name="driver_id" value="{{d['id']}}">
                <select name="approved">
                  <option value="1" {% if d["approved"] %}selected{% endif %}>Approve</option>
                  <option value="0" {% if not d["approved"] %}selected{% endif %}>Block</option>
                </select>
                <button type="submit">Save</button>
              </form>

              <form method="post" action="/admin/driver/balance" style="display:inline-block">
                <input type="hidden" name="driver_id" value="{{d['id']}}">
                <input name="amount" placeholder="+10 / -2" style="width:90px">
                <input name="note" placeholder="note" style="width:140px">
                <button type="submit">Balans</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <div class="muted" style="margin-top:10px">Topup request-lər “balance_txns” kimi yazılır (REQUEST:card2card və ya REQUEST:m10). Admin balans düzəlişi ilə təsdiqləyir.</div>
    </div>

    <div class="card">
      <h3>Son sifarişlər (rides)</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Pickup</th><th>Dropoff</th><th>Km</th><th>Status</th><th>Price</th><th>Created</th></tr>
        </thead>
        <tbody>
        {% for r in rides %}
          <tr>
            <td>{{r["id"]}}</td>
            <td>{{r["pickup"]}}</td>
            <td>{{r["dropoff"]}}</td>
            <td>{{r["distance"]}}</td>
            <td>{{r["status"]}}</td>
            <td>{{r["price"]}}</td>
            <td>{{r["created_at"]}}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
